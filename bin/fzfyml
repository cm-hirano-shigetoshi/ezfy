#!/usr/bin/env bash
set -eu
readonly SUBCMD=$1
shift

readonly PYTHON=python
readonly TOOLDIR=$(dirname $(dirname $(perl -MCwd=realpath -le 'print realpath shift' ${0})))

if [[ "${SUBCMD}" = "run" ]]; then
  readonly YAML=$1
  shift
  perl <(${PYTHON} ${TOOLDIR}/main/creator.py ${TOOLDIR}/main/template.pl ${YAML}) "$@"
elif [[ "${SUBCMD}" = "debug" ]]; then
  readonly YAML=$1
  shift
  ${PYTHON} ${TOOLDIR}/main/creator.py ${TOOLDIR}/main/template.pl ${YAML}
elif [[ "${SUBCMD}" = "preview" ]]; then
  readonly FILE=$1
  shift
  ${TOOLDIR}/preview/${FILE} "$@"
fi
